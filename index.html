<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Producción - Cirineo 2025</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        .custom-scrollbar::-webkit-scrollbar { height: 8px; width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        
        .machine-col { min-width: 100px; width: 100px; }
        .machine-col.expanded { min-width: 200px; width: 200px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 font-sans">

    <div id="root"></div>

    <script type="text/babel">
        // --- INICIALIZACIÓN SEGURA ---
        const { useState, useEffect, useMemo, useCallback } = React;

        // Configuración Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBqHgV4vDat1-VmZfKbiPg7nuiX-ROcexw",
            authDomain: "cirineo-cec21.firebaseapp.com",
            projectId: "cirineo-cec21",
            storageBucket: "cirineo-cec21.firebasestorage.app",
            messagingSenderId: "620210618284",
            appId: "1:620210618284:web:482bab9bf74650fff18409",
            measurementId: "G-B7YLM78RVW"
        };

        // Inicializar Firebase (Verificación para evitar doble carga)
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();

        // --- CONSTANTES ---
        const ADMIN_PIN = "1352";
        
        // Copia de máquinas para evitar mutación
        const RAW_MACHINES = [
            { id: 'm35', name: 'MAQ 35', type: 'SANTONI SM8 TOP 2V', diam: 16 },
            { id: 'm39', name: 'MAQ 39', type: 'SANTONI SM8 TOP 2V', diam: 16 },
            { id: 'm40', name: 'MAQ 40', type: 'SANTONI SM8 TOP 2V', diam: 16 },
            { id: 'm36', name: 'MAQ 36', type: 'CIXING GE82', diam: 15 },
            { id: 'm38', name: 'MAQ 38', type: 'SANTONI SM8 TOP 2V', diam: 15 },
            { id: 'm37', name: 'MAQ 37', type: 'SANTONI SM8 TOP 2V', diam: 15 },
            { id: 'm29', name: 'MAQ 29', type: 'SANTONI SM8 EVO 4', diam: 16 },
            { id: 'm28', name: 'MAQ 28', type: 'SANTONI SM8 EVO 4', diam: 16 },
            { id: 'm27', name: 'MAQ 27', type: 'SANTONI SM8 EVO 4', diam: 15 },
            { id: 'm33', name: 'MAQ 33', type: 'SANTONI SM8 EVO 4', diam: 15 },
            { id: 'm1',  name: 'MAQ 1',  type: 'CIXING', diam: 14 },
            { id: 'm30', name: 'MAQ 30', type: 'CIXING GE82', diam: 14 },
            { id: 'm31', name: 'MAQ 31', type: 'CIXING GE82', diam: 14 },
            { id: 'm6',  name: 'MAQ 6',  type: 'CIXING GE82', diam: 14 },
            { id: 'm32', name: 'MAQ 32', type: 'CIXING GE82', diam: 14 },
            { id: 'm13', name: 'MAQ 13', type: 'SANTONI SM8 EVO 4', diam: 13 },
            { id: 'm12', name: 'MAQ 12', type: 'SANTONI SM8 EVO 4', diam: 13 },
            { id: 'm24', name: 'MAQ 24', type: 'SANTONI SM8 EVO 4', diam: 13 },
            { id: 'm8',  name: 'MAQ 8',  type: 'SANTONI SM8 TOP 2', diam: 13 },
        ];

        const ALL_ROWS = [
            'MIERCOLES 12', 'JUEVES 13', 'VIERNES 14', 'SABADO 15', 'DOMINGO 16',
            'LUNES 17', 'MARTES 18', 'MIERCOLES 19', 'JUEVES 20', 'VIERNES 21',
            'SABADO 22', 'DOMINGO 23', 'LUNES 24', 'MARTES 25', 'MIERCOLES 26',
            'JUEVES 27', 'VIERNES 28', 'SABADO 29', 'DOMINGO 30'
        ];

        const CURRENT_WEEK_ROWS = ALL_ROWS.slice(0, 7); 

        // --- COMPONENTES ---

        const MachineIconImage = ({ className }) => {
            const [hasError, setHasError] = useState(false);
            const imageUrl = "https://raw.githubusercontent.com/jesusvn1993mplvt3-ai/CIRINEO/refs/heads/main/icon.png";
            if (hasError) return <div className="text-xs text-gray-500"><i data-lucide="cpu" className="w-4 h-4"></i></div>;
            return <img src={imageUrl} className={className + " object-contain"} onError={() => setHasError(true)} />;
        };

        const AdminAuthModal = ({ onClose, onSuccess }) => {
            const [pin, setPin] = useState('');
            const [error, setError] = useState(false);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (pin === ADMIN_PIN) {
                    onSuccess();
                } else {
                    setError(true);
                    setPin('');
                    setTimeout(() => setError(false), 2000);
                }
            };

            return (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4" onClick={onClose}>
                    <div className="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-sm animate-fade-in" onClick={e => e.stopPropagation()}>
                        <div className="text-center mb-6">
                            <div className="w-12 h-12 bg-slate-900 rounded-full flex items-center justify-center mx-auto mb-3 text-white">
                                <i data-lucide="lock" className="w-6 h-6"></i>
                            </div>
                            <h3 className="text-lg font-bold">Acceso Administrativo</h3>
                            <p className="text-xs text-slate-500">Ingresa el PIN maestro</p>
                        </div>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <input 
                                type="password" 
                                autoFocus
                                className={`w-full text-center text-3xl font-mono p-3 border-2 rounded-xl outline-none transition-colors ${error ? 'border-red-500 bg-red-50' : 'border-slate-200 focus:border-blue-500'}`}
                                placeholder="----"
                                maxLength={4}
                                value={pin}
                                onChange={e => setPin(e.target.value)}
                            />
                            {error && <p className="text-red-500 text-xs text-center font-bold">PIN Incorrecto</p>}
                            <button type="submit" className="w-full bg-slate-900 text-white py-3 rounded-xl font-bold hover:bg-slate-800 transition">
                                ACCEDER
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        const StatsDashboard = ({ data, onClose }) => {
            const stats = useMemo(() => {
                const machineTotals = {};
                let globalTotal = 0;
                let globalTarget = 0;
                
                // Usamos RAW_MACHINES para iterar
                RAW_MACHINES.forEach(m => {
                    let mTotal = 0;
                    let mTarget = 0;
                    ALL_ROWS.forEach(row => {
                        const cell = data[row]?.[m.id];
                        if (cell) {
                            mTotal += (cell.actual || 0);
                            if (cell.plan_time_min > 0) {
                                mTarget += ((24 * 60) / cell.plan_time_min); 
                            }
                        }
                    });
                    machineTotals[m.id] = { total: mTotal, target: mTarget };
                    globalTotal += mTotal;
                    globalTarget += mTarget;
                });

                // Creamos copia para ordenar
                const sorted = [...RAW_MACHINES].sort((a, b) => 
                    machineTotals[b.id].total - machineTotals[a.id].total
                );

                return { machineTotals, globalTotal, globalTarget, sorted };
            }, [data]);

            const maxVal = stats.sorted.length > 0 ? stats.machineTotals[stats.sorted[0].id].total : 0;

            return (
                <div className="fixed inset-0 bg-white z-50 overflow-auto animate-fade-in flex flex-col">
                    <div className="max-w-5xl w-full mx-auto p-6 flex-1">
                        <div className="flex justify-between items-center mb-6 border-b pb-4">
                            <div>
                                <h2 className="text-2xl font-bold text-slate-900">Dashboard</h2>
                                <p className="text-slate-500 text-sm">Rendimiento en tiempo real</p>
                            </div>
                            <button onClick={onClose} className="p-2 hover:bg-slate-100 rounded-full"><i data-lucide="x" className="w-6 h-6"></i></button>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                            <div className="bg-blue-600 text-white p-5 rounded-2xl shadow-lg shadow-blue-200">
                                <div className="text-blue-100 text-sm font-medium mb-1">Producción Total</div>
                                <div className="text-3xl font-black">{stats.globalTotal.toLocaleString()} <span className="text-lg font-normal opacity-80">pzas</span></div>
                            </div>
                            <div className="bg-white border border-slate-200 p-5 rounded-2xl shadow-sm">
                                <div className="text-slate-500 text-sm font-medium mb-1">Mejor Máquina</div>
                                <div className="text-2xl font-bold text-slate-800">{stats.sorted[0]?.name || '-'}</div>
                                <div className="text-sm text-green-600 font-bold">
                                    {stats.sorted[0] ? stats.machineTotals[stats.sorted[0].id].total.toLocaleString() : 0} pzas
                                </div>
                            </div>
                            <div className="bg-white border border-slate-200 p-5 rounded-2xl shadow-sm">
                                <div className="text-slate-500 text-sm font-medium mb-1">Cumplimiento Global</div>
                                <div className="text-2xl font-bold text-slate-800">
                                    {stats.globalTarget > 0 ? ((stats.globalTotal / stats.globalTarget) * 100).toFixed(1) : 0}%
                                </div>
                                <div className="w-full bg-slate-100 h-2 mt-2 rounded-full overflow-hidden">
                                    <div className="bg-green-500 h-full" style={{ width: `${Math.min(100, (stats.globalTotal / (stats.globalTarget || 1)) * 100)}%` }}></div>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white border border-slate-200 rounded-2xl p-6 shadow-sm">
                            <h3 className="font-bold text-slate-800 mb-6">Ranking de Producción</h3>
                            <div className="space-y-4">
                                {stats.sorted.map(m => {
                                    const val = stats.machineTotals[m.id].total;
                                    const percent = maxVal > 0 ? (val / maxVal) * 100 : 0;
                                    return (
                                        <div key={m.id} className="flex items-center gap-4">
                                            <div className="w-16 text-xs font-bold text-slate-600 text-right">{m.name.replace('MAQ ','M')}</div>
                                            <div className="flex-1 h-8 bg-slate-50 rounded-lg overflow-hidden relative">
                                                <div 
                                                    className="h-full bg-slate-800 rounded-r-lg flex items-center px-2 transition-all duration-500" 
                                                    style={{ width: `${percent}%` }}
                                                ></div>
                                                <span className="absolute left-2 top-0 bottom-0 flex items-center text-xs text-slate-500 font-medium mix-blend-difference text-white pl-2">
                                                    {val.toLocaleString()}
                                                </span>
                                            </div>
                                        </div>
                                    )
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const PlanningModal = ({ machine, rowId, currentData, onClose, onSave }) => {
            const [model, setModel] = useState(currentData?.derivedPlan?.plan_model || '');
            const [targetQty, setTargetQty] = useState(currentData?.derivedPlan?.plan_target_qty || '');
            const [timeMin, setTimeMin] = useState(currentData?.derivedPlan?.plan_time_min || '');
            const [hours, setHours] = useState(currentData?.derivedPlan?.plan_hours || 24);

            const handleSave = () => {
                const data = {
                    plan_model: model || null,
                    plan_target_qty: Number(targetQty) || null,
                    plan_time_min: Number(timeMin) || null,
                    plan_hours: Number(hours) || null,
                };
                onSave(rowId, machine.id, data);
                onClose();
            };

            return (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4" onClick={onClose}>
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md animate-fade-in" onClick={e => e.stopPropagation()}>
                        <div className="p-4 border-b bg-slate-50 rounded-t-2xl flex justify-between items-center">
                            <h3 className="font-bold">Planificar: {machine.name}</h3>
                            <button onClick={onClose}><i data-lucide="x" className="w-5 h-5"></i></button>
                        </div>
                        <div className="p-6 space-y-4">
                            <div className="grid grid-cols-2 gap-4">
                                <label className="block text-xs font-bold text-slate-500">
                                    MODELO
                                    <input type="text" value={model} onChange={(e) => setModel(e.target.value)} className="mt-1 w-full p-2 border rounded-lg text-slate-800 text-sm font-semibold" placeholder="Ej: B001" />
                                </label>
                                <label className="block text-xs font-bold text-slate-500">
                                    META TOTAL
                                    <input type="number" value={targetQty} onChange={(e) => setTargetQty(e.target.value)} className="mt-1 w-full p-2 border rounded-lg text-slate-800 text-sm font-semibold" />
                                </label>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <label className="block text-xs font-bold text-slate-500">
                                    MIN/PIEZA
                                    <input type="number" value={timeMin} onChange={(e) => setTimeMin(e.target.value)} className="mt-1 w-full p-2 border rounded-lg text-slate-800 text-sm font-semibold" />
                                </label>
                                <label className="block text-xs font-bold text-slate-500">
                                    HORAS TURNO
                                    <select value={hours} onChange={(e) => setHours(e.target.value)} className="mt-1 w-full p-2 border rounded-lg text-slate-800 text-sm font-semibold">
                                        <option value={12}>12 Horas</option>
                                        <option value={24}>24 Horas</option>
                                    </select>
                                </label>
                            </div>
                            <button onClick={handleSave} className="w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 mt-4 shadow-lg shadow-blue-200">
                                Guardar Plan
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [productionData, setProductionData] = useState({});
            const [loading, setLoading] = useState(true);
            const [expandedMachineId, setExpandedMachineId] = useState(null);
            
            // Estados de Admin
            const [isAdmin, setIsAdmin] = useState(false);
            const [showAdminLogin, setShowAdminLogin] = useState(false);
            const [showStats, setShowStats] = useState(false);
            const [planningModal, setPlanningModal] = useState(null);

            // Cargar Iconos Lucide
            useEffect(() => { 
                if (window.lucide) window.lucide.createIcons(); 
            });

            // Auth y Data
            useEffect(() => {
                auth.signInAnonymously().catch(console.error);
                
                const unsubscribe = db.collection('produccion_2025').onSnapshot((snapshot) => {
                    const data = {};
                    snapshot.forEach((doc) => data[doc.id] = doc.data());
                    setProductionData(data);
                    setLoading(false);
                }, (error) => {
                    console.error("Error obteniendo datos:", error);
                    setLoading(false);
                });
                
                return () => unsubscribe();
            }, []);

            // Procesamiento de Datos (Memoized)
            const processedData = useMemo(() => {
                const rows = [];
                const machineState = {}; 

                ALL_ROWS.forEach((rowId) => {
                    const rowData = {};
                    RAW_MACHINES.forEach(machine => {
                        const rawCell = productionData[rowId]?.[machine.id] || {};
                        
                        if (rawCell.plan_model) {
                            machineState[machine.id] = {
                                plan: { ...rawCell },
                                accumulated: 0
                            };
                        }

                        const activeState = machineState[machine.id];
                        const activePlan = activeState ? activeState.plan : null;
                        const actualQty = Number(rawCell.actual) || 0;
                        
                        if (activeState) activeState.accumulated += actualQty;

                        let cellCalculations = {};
                        if (activePlan) {
                            const totalTarget = activePlan.plan_target_qty || 1;
                            const totalProgressPercent = Math.min(100, ((activeState.accumulated) / totalTarget) * 100);
                            const mins = activePlan.plan_time_min || 0;
                            const dailyTarget = mins > 0 ? Math.round(((activePlan.plan_hours || 24)*60)/mins) : 0;

                            cellCalculations = {
                                derivedPlan: activePlan,
                                accumulatedOfPlan: activeState.accumulated,
                                totalProgressPercent: totalProgressPercent.toFixed(1),
                                dailyTarget
                            };
                        }

                        rowData[machine.id] = { ...rawCell, ...cellCalculations };
                    });
                    rows.push({ rowId, machines: rowData });
                });
                return rows;
            }, [productionData]);

            // Función Guardar
            const handleUpdate = useCallback(async (rowId, machineId, newData) => {
                try {
                    const docRef = db.collection('produccion_2025').doc(rowId);
                    const payload = {};
                    Object.keys(newData).forEach(key => {
                        payload[`${machineId}.${key}`] = newData[key];
                    });
                    await docRef.set(payload, { merge: true });
                } catch (err) { console.error("Error guardando:", err); }
            }, []);

            if (loading) return (
                <div className="h-screen flex items-center justify-center text-slate-400 gap-2">
                    <i data-lucide="loader-2" className="animate-spin w-8 h-8"></i>
                    <span>Cargando datos...</span>
                </div>
            );

            // Filtro de filas
            const visibleRowsData = processedData.filter(row => isAdmin || CURRENT_WEEK_ROWS.includes(row.rowId));

            return (
                <div className="min-h-screen flex flex-col font-sans">
                    {/* MODALES */}
                    {showAdminLogin && (
                        <AdminAuthModal 
                            onClose={() => setShowAdminLogin(false)} 
                            onSuccess={() => { setIsAdmin(true); setShowAdminLogin(false); }} 
                        />
                    )}
                    {showStats && <StatsDashboard data={productionData} onClose={() => setShowStats(false)} />}
                    {planningModal && (
                        <PlanningModal 
                            machine={RAW_MACHINES.find(m => m.id === planningModal.machineId)}
                            rowId={planningModal.rowId}
                            currentData={planningModal.data}
                            onClose={() => setPlanningModal(null)}
                            onSave={handleUpdate}
                        />
                    )}

                    {/* HEADER */}
                    <header className="bg-white border-b border-slate-200 sticky top-0 z-30 px-4 py-3 shadow-sm flex justify-between items-center">
                        <div className="flex items-center gap-2">
                            <div className="bg-slate-800 text-white p-2 rounded-lg shadow-lg shadow-slate-200">
                                <i data-lucide="factory" className="w-5 h-5"></i>
                            </div>
                            <div>
                                <h1 className="font-bold text-slate-800 leading-tight text-sm md:text-base">CONTROL DE PRODUCCIÓN</h1>
                                <p className="text-[10px] text-slate-400 font-bold tracking-wider">CIRINEO TEXTIL</p>
                            </div>
                        </div>
                        <div className="flex gap-2">
                            {!isAdmin ? (
                                <button onClick={() => setShowAdminLogin(true)} className="flex items-center gap-2 px-3 py-2 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-lg text-xs font-bold transition">
                                    <i data-lucide="lock" className="w-3 h-3"></i> Admin
                                </button>
                            ) : (
                                <>
                                    <button onClick={() => setShowStats(true)} className="flex items-center gap-2 px-3 py-2 bg-blue-50 text-blue-600 hover:bg-blue-100 rounded-lg text-xs font-bold transition">
                                        <i data-lucide="bar-chart-2" className="w-4 h-4"></i>
                                        <span className="hidden md:inline">Gráficas</span>
                                    </button>
                                    <button onClick={() => setIsAdmin(false)} className="px-3 py-2 bg-red-50 text-red-500 hover:bg-red-100 rounded-lg text-xs font-bold transition">
                                        Salir
                                    </button>
                                </>
                            )}
                        </div>
                    </header>

                    {/* MAIN TABLE */}
                    <main className="flex-1 overflow-auto p-2 md:p-4 custom-scrollbar">
                        <div className="bg-white rounded-xl shadow border border-slate-200 overflow-hidden">
                            <div className="overflow-x-auto custom-scrollbar">
                                <table className="w-full border-collapse">
                                    <thead>
                                        <tr className="bg-slate-50 border-b border-slate-200 text-left">
                                            <th className="sticky left-0 z-20 bg-slate-50 p-3 min-w-[120px] border-r border-slate-200 shadow-sm text-xs text-slate-500 font-bold uppercase tracking-wider">Fecha</th>
                                            {RAW_MACHINES.map(m => (
                                                <th key={m.id} className={`machine-col ${expandedMachineId === m.id ? 'expanded' : ''} p-2 border-r border-slate-100 align-top transition-all duration-300`}>
                                                    <button onClick={() => setExpandedMachineId(expandedMachineId === m.id ? null : m.id)} className="w-full flex flex-col items-center gap-1 hover:bg-slate-100 rounded p-1 transition group">
                                                        <div className="w-8 h-8 opacity-80 group-hover:opacity-100 transition"><MachineIconImage className="w-full h-full" /></div>
                                                        <span className="text-[11px] font-black text-slate-700">{m.name.replace('MAQ ','M')}</span>
                                                    </button>
                                                </th>
                                            ))}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {visibleRowsData.map((row, idx) => (
                                            <tr key={row.rowId} className={`border-b border-slate-100 hover:bg-slate-50 transition ${idx % 2 === 0 ? 'bg-white' : 'bg-slate-50/40'}`}>
                                                <td className="sticky left-0 z-10 bg-inherit p-3 border-r border-slate-200 text-xs font-bold text-slate-600 shadow-sm whitespace-nowrap">
                                                    {row.rowId}
                                                </td>
                                                {RAW_MACHINES.map(m => {
                                                    const cell = row.machines[m.id];
                                                    const hasPlan = !!cell.derivedPlan;
                                                    const isExpanded = expandedMachineId === m.id;

                                                    return (
                                                        <td key={m.id} className={`p-1 border-r border-slate-100 relative machine-col ${isExpanded ? 'expanded' : ''} transition-all align-top`}>
                                                            <div className="flex flex-col h-full gap-1">
                                                                {/* Cabecera del Plan */}
                                                                <div className={`rounded text-[10px] p-1 flex justify-between items-start min-h-[1.5rem] transition-colors ${hasPlan ? 'bg-indigo-50/60' : ''}`}>
                                                                    {hasPlan && (
                                                                        <div className="flex-1 overflow-hidden">
                                                                            <div className="font-bold text-indigo-900 truncate" title={cell.derivedPlan.plan_model}>{cell.derivedPlan.plan_model}</div>
                                                                            <div className="mt-0.5 w-full bg-indigo-100 h-1 rounded-full overflow-hidden">
                                                                                <div className="bg-indigo-500 h-full" style={{width: `${cell.totalProgressPercent}%`}}></div>
                                                                            </div>
                                                                            {(isExpanded || isAdmin) && (
                                                                                <div className="mt-1 text-[9px] text-slate-500 leading-tight">
                                                                                    Meta: <b>{cell.dailyTarget}</b>
                                                                                </div>
                                                                            )}
                                                                        </div>
                                                                    )}
                                                                    {isAdmin && (
                                                                        <button 
                                                                            onClick={() => setPlanningModal({ machineId: m.id, rowId: row.rowId, data: cell })}
                                                                            className="ml-1 text-slate-300 hover:text-blue-600 transition"
                                                                        >
                                                                            <i data-lucide="plus-circle" className="w-3 h-3"></i>
                                                                        </button>
                                                                    )}
                                                                </div>

                                                                {/* Input Producción */}
                                                                <input 
                                                                    type="number" 
                                                                    value={cell.actual ?? ''}
                                                                    placeholder="-"
                                                                    className={`w-full text-center font-bold text-sm bg-transparent outline-none py-2 rounded border border-transparent focus:bg-white focus:border-blue-300 focus:shadow-sm transition ${cell.actual > 0 ? 'text-slate-800' : 'text-slate-300'}`}
                                                                    onChange={(e) => handleUpdate(row.rowId, m.id, { actual: Number(e.target.value) })}
                                                                />
                                                            </div>
                                                        </td>
                                                    );
                                                })}
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
